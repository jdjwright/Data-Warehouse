# School Data Warehouse Generator

## Introduction

This project generates a dummy school data warehouse populated with synthetic data. It's designed to simulate a realistic school environment, including students, staff, classes, attendance, and assessment data. The warehouse is built on a MySQL-compatible database (MariaDB by default).

## Environment Setup

### Docker-based Setup (Recommended)

For a consistent and isolated environment, it's recommended to use Docker. Please refer to `Enviroment_setup.md` for detailed instructions on setting up the Docker containers for the database and the Python environment.

### Manual Setup (Running Scripts Locally)

If you prefer to run the Python scripts directly on your local machine, you will need Python 3.x and the following libraries:

*   pandas
*   sqlalchemy
*   pymysql
*   Faker

You can install these using pip:
```bash
pip install pandas sqlalchemy pymysql Faker
```
A `requirements.txt` file is also provided for convenience:
```bash
pip install -r requirements.txt
```
Ensure you have a MySQL-compatible database server running and accessible.

## Configuration (`config.json`)

The `config.json` file is crucial for customizing the data generation process and database connections.

### `database_config`
This section contains the connection details for your target database.
*   `host`: The hostname or IP address of your database server (e.g., "mariadb" if using the provided Docker setup, or "localhost").
*   `user`: Database username.
*   `password`: Database password.
*   `database`: The name of the database to use/create.
*   `port`: The port number for the database connection (default for MySQL is 3306).

### `school_parameters`
Defines various parameters related to the school's structure and demographics.
*   `students_to_create`: Number of student records to generate.
*   `staff_to_create`: Number of staff records to generate.
*   `email_domain`: The email domain to use for generated email addresses (e.g., "example.edu").
*   `year_groups`: A list of year group names (e.g., `["N", "R", "1", ..., "13"]`).
*   `tutor_groups_suffix`: Suffixes for tutor groups (e.g., `["A", "B", "C"]`).
*   `houses`: List of school houses (e.g., `["Red", "Blue"]`).
*   `nationalities`: List of nationalities for students/staff.
*   `ethnicities`: List of ethnicities.
*   `eal_statuses`: English as an Additional Language statuses.
*   `sen_statuses`: Special Education Needs statuses.

### `class_generation`
Parameters for generating classes and class structures.
*   `department_custom_distribution`: Allows custom class count distribution per department and year group.
    *   Example: `{"department": "Physics", "numbers": {"9": 3, "10": 2}}` means 3 Physics classes for year 9, 2 for year 10.
*   `default_year_groups_for_classes`: Year groups for which classes will be generated by default if not specified in custom distribution.
*   `default_classes_per_group`: Default number of classes per year group if not specified in custom distribution.
*   `min_students_per_class`: Minimum number of students to enroll in a class.
*   `max_students_per_class`: Maximum number of students to enroll in a class.

### `attendance_rules`
Defines the structure of the school week and attendance code probabilities.
*   `week_structure`: A dictionary defining teaching periods for each day of the week.
    *   Example: `"Monday": ["AM Reg", "P1", "P2", "P3", "PM Reg", "P4"]`
*   `attendance_codes_probabilities`: A dictionary mapping attendance codes to their probability of occurrence.
    *   Example: `{"/": 0.90, "N": 0.03, ...}`

### `data_file_paths`
Specifies paths to CSV files for dimension data. This allows you to provide your own specific data for key dimensions.
*   **`dim_dates_csv_path`**:
    *   **Required**: This path *must* point to a CSV file containing your date dimension data. The project relies on this file for academic year structure, holidays, etc.
    *   **Expected Columns**: `id` (int, PK), `date` (YYYY-MM-DD or parsable by pandas), `academic_year` (e.g., "2023/24"), `term_name` (e.g., "Autumn Term"), `term_order_number` (int), `day_of_week_number` (int, Monday=0 or 1), `week_of_year_number` (int), `day_name` (e.g., "Monday"), `month_name` (e.g., "January"), `year_number` (int), `term_and_year` (e.g., "Autumn 2023"), `academic_year_order` (int), `term_order` (int), `week_order_number` (int), `week_of_academic_year_number` (int), `day_of_year_number` (int), `day_of_term_number` (int), `day_of_academic_year_number` (int), `month_number` (int), `day_number` (int), `is_weekend` (e.g., "Weekend", "Weekday"), `week_commencing_date` (YYYY-MM-DD), `holiday_type` (e.g., "Christmas Holiday", "Not a holiday"), `half_termly_report_day` (boolean/int), `first_day_of_academic_year` (YYYY-MM-DD), `last_day_of_academic_year` (YYYY-MM-DD), `first_day_of_half_term` (YYYY-MM-DD), `last_day_of_half_term` (YYYY-MM-DD), `previous_thursday` (YYYY-MM-DD).
    *   A placeholder `data/dim_dates.csv` is created with these headers. You **must** populate this file.
*   **`dim_departments_csv_path`**:
    *   **Optional**: If a path to a CSV file is provided here, the data from this file will be loaded into the `dim_Departments` table.
    *   If the path is empty, `null`, or the file is not found, the script `create_dim_departments.py` will create a default set of departments.
    *   **Expected Columns**: `isams_subject_code` (e.g., "MAT"), `subject_name` (e.g., "Mathematics"), `report_name` (e.g., "Maths"). Other columns like `isams_id`, `isams_department_id` can be included if available.
    *   A placeholder `data/dim_departments.csv` is created with sample headers.
*   **`dim_report_grade_csv_path`**:
    *   **Optional**: If a path to a CSV file is provided, it will be used to populate the `dim_report_grade` table.
    *   If the path is empty, `null`, or the file is not found, the script `create_dim_report_grade.py` will create a default set of report grades.
    *   **Expected Columns**: `result` (e.g., "A*", "9", "Pass"), `numerical_result` (float), `ucas_points` (int, optional), `gis_points` (int, optional), `data_type` (e.g., "Attainment", "Effort", "Target grade"), `printable_result` (string, optional), `hex_colour` (string, optional), `hex_colour_text` (string, optional), `description` (string, optional), `total_grades` (int, optional), `igcse_pass` (boolean/int, optional), `category` (e.g., "GCSE 9-1", "A-Level", "Generic").
    *   A placeholder `data/dim_report_grade.csv` is created with sample headers.

## Running the Warehouse Creation

1.  **Configure `config.json`**: Before running, ensure `config.json` is correctly set up, especially the `database_config` and `data_file_paths` (specifically `dim_dates_csv_path` which needs to be populated).
2.  **Execute the main script**:
    ```bash
    python run_warehouse_creation.py
    ```
    This script will:
    *   Execute the `warehouse_schema.sql` to set up database tables.
    *   Run a series of Python scripts to generate and load data into the tables.

## Script Overview

The `run_warehouse_creation.py` script executes the following key Python scripts in order:

*   `load_dim_dates.py`: Loads date dimension data from the CSV specified in `config.json`.
*   `create_dim_departments.py`: Creates department dimension data, either from CSV or defaults.
*   `create_dim_report_grade.py`: Creates report grade dimension data, either from CSV or defaults.
*   `CreatePeople.py`: Generates basic records for people (students and staff) including unique IDs.
*   `create students.py`: Generates detailed student records based on `CreatePeople.py` output and configuration.
*   `create staff.py`: Generates detailed staff records, teaching groups, and class enrolments based on configuration.
*   `create attendance.py`: Generates attendance data for students based on configuration.
*   `create report data.py`: Generates report card data (grades, comments, etc.) for students.
*   `Create pivoted report card`: Transforms the report data into a pivoted format suitable for certain types of analysis and reporting.

## Redundant Scripts

*   **`Create People.py` (with a space in the name)**: This script is redundant. The correct script used by the orchestrator is `CreatePeople.py` (no space). The one with the space can be ignored and may be removed in future updates.

---
*This README provides a general overview. For specific implementation details, refer to the individual scripts and `config.json`.*
